# Release Notes

## Upgrading to 8.0

One of the most invasive changes was adding the support of defining arbitrary attributes on code blocks in SuperFences
via the brace header format. This caused numerous changes that affects those define their own custom fences. It also

### SuperFences Attribute List Support

SuperFences has numerous changes so that users who wish not to use Pygments can set arbitrary attributes via the brace
header format so that can more extensively configure their code blocks for JavaScript syntax highlighters. This required
changes to how custom fences were handled. The changes mainly affect people using custom fences. In general, people not
defining their own custom fences will probably not notice any differences except they can now set attributes to code
blocks now.

If users are still using the legacy tab feature of SuperFences, they will find that their tabs will no longer work.

- Custom fence formatters are now expected to take a new keyword attribute called `attrs`. `attrs` contains a dictionary
  of key/value pairs defining attributes that should be attached to the main block element generated by a given
  formatter. In general, custom formatters *should* handle these, but at the very least, they should be updated to take
  the argument even if they don't do anything with them. If your custom fence already accepts `**kwargs`, your fence
  should continue to work, but to apply the attributes, you will have to read the `attrs` parameter from `kwargs`.

- Custom fence validators have been updated to handle validation of inputs by assigning valid inputs to either an
  `options` dictionary or an `attrs` dictionary. The new function signature looks like
  `#!py3 validator(language, inputs, options, attrs, md):`. Inputs should never be modified. Options should have
  inputs added to it that configure a formatter's features while `attrs` should have all other inputs. `attrs` will only
  be passed to a formatter when Python Markdown's [`attr_list`][attr-list] extension is enabled.

    SuperFences will detect if you are using an older validator and should gracefully transition and use the old format,
    but it is strongly recommended to use the new format.

- Since attributes and options are now parsed via the [`attr_list`][attr-list] extension, custom fences can no longer
  allow inputs in the form `key=`, they must be in the form `key`, `key="value"` or `key=value`. When defining an input
  in the form `key` (with no value), the value will be the `key` name. To specify an empty `key`, please use `key=""`.

- If a custom validator fails, SuperFences will now gracefully handle the error and try the next custom fence in the
  queue. If a custom formatter fails, SuperFences will gracefully handle the error and abort processing the fence. If
  you suspect your custom fence is not working, you should add your own debug code to your custom fence to verify
  whether it is failing or not.

- The tabbed feature of SuperFences has now been completely removed. Please use [Tabbed](../extensions/tabbed.md)
  instead to create generic tabbed interfaces for code blocks and other content.

### Highlight Changes

Highlight added some new options to give users a little more control over code output format. Also some minor changes
were made as a result of it now able to have arbitrary attributes passed to it that are defined by a user via
SuperFences.

- Previous versions of Highlight, when Pygments was disabled, would apply attributes to code blocks when options like
  `linenums` were enabled. These attributes were often not helpful as they were generic and did not apply to all
  JavaScript syntax highlighters. When Pygments is disabled, Highlight will no longer apply these unhelpful attributes
  to code blocks, instead, if the user enables Python Markdown's `attr_list`, they can use SuperFences and define the
  arbitrary attributes they need in the fenced code brace header, these attributes will be applied to the generated code
  block.

    For instance, if a user needed to specify the line number start with an attribute `data-linenum-start`, they could
    simply use the brace header format to define this new attribute:

    ````
    ```{.python data-linenum-start="30"}
    import sys
    ```
    ````

- Custom classes, IDs, and attributes are applied to the `code` element of generated code blocks, but if a JavaScript
  highlighter requires classes, IDs, and attributes to be applied to the `pre` element instead of the `code`
  element, the user can enable the new option in [Highlight](../extensions/highlight.md) called `code_attr_on_pre`.

- By default, JavaScript ready code blocks would normally have the specified language class prefixed with `language-`.
  This follows the HTML 5 specification, but some highlighters may prefer something different. The prefix can now be
  changed with the new [Highlight](../extensions/highlight.md) option called `language_prefix`.

### ExtraRawHTML Removed

ExtraRawHTML has officially been removed. Please use Python Markdown's [`md_in_html`][md-in-html] extension instead.

### SaneHeaders Added

Same headers implements Markdown headers more like CommonMark. Headers require a space after the `#` symbol in order for
the line to be treated as a header. This allows you to use MagicLink issues at the start of a line. See
[SaneHeaders documentation](../extensions/saneheaders.md) for more information.

## Upgrading to 7.0

### Tabbed Extension
A new extension called Tabbed has been added. With the arrival of this general purpose tabbed content extension, it has
made the old SuperFences tabbed content feature redundant. By default, SuperFences will now change the classes it uses
for it's tabbed feature to match those of the new Tabbed extension. CSS should be updated accordingly.

The classes that have changed are `supferfences-tabs` and `superfences-content`, which have changed to `tabbed-set` and
`tabbed-content` respectively. Example CSS is updated in SuperFences for
[reference](../extensions/superfences.md).

To help with the transition though, you can quickly switch back to the old style classes by simply enabling the
SuperFences' global option `legacy_tab_classes`:

```py3
extension_configs = {
    "pymdownx.superfences": {
        "legacy_tab_classes": True
    }
}
```

To learn more about migrating to the Tabbed extension, checkout the [Tabbed documentation](../extensions/tabbed.md).

SuperFences' tab content feature will be removed in 8.0. There is no formal date for when this will occur, but it is
recommended to begin migrating as soon as possible, but `legacy_tab_classes` can be used as a stop gap for the short
term.

### Option Deprecation in SuperFences

SuperFences has deprecated `highlight_code`. This option now does nothing and will be removed in some future release.
If this option was used, you will have to use [custom fences](../extensions/superfences.md#custom-fences) to implement
this behavior with your own custom formatter.

### SuperFences Configurable Classes and IDs

Additional classes and IDs can now be injected into fenced code blocks with the format ` ```{.lang .more-class} `.

The attribute list feature also impacts the the custom formatter. While the default formatters will still inject
classes and IDs to the top level element to preserve backwards compatibility, the formatter now must accept the new
keyword parameters `classes` and `id_value`. If you have a custom formatter that does not adhere to this new
requirement, you will see a user warning.

The new format is:

```py3
def custom_formatter(source, language, css_class, options, md, classes=None, id_value='', **kwargs):
    return string
```

While it is recommended for a user to update their custom formatters to receive the new parameters, at the very
least, users should add `**kwargs` to future proof their formatters.

### CodeHilite Separation

SuperFences and InlineHilite no longer sync settings from CodeHilite. To configure either of the extensions, Pymdown
Extension's Highlight extension must be used. CodeHilite can be run along side Highlight if desired, but CodeHilite
cannot be used to augment SuperFences or InlineHilite's behavior.

### Keys Alias Changes

Previously `alt`, `left-alt`, and `right-alt` had aliases `menu`, `left-menu`, `right-menu`, `lmenu`, and `rmenu`. These
aliases have been removed. `menu` will now be an alias for `context-menu`.

It is known that *Alt* has been referred to as *Menu* in the real world, but so is the actual *Menu*/*Apps* key. This
will hopefully create less confusion in the long term, even if there is a little in the short term.

## Upgrading to 6.0

While there are a number of new features and bug fixes, the only backwards incompatible changes are with SuperFences'
custom fences. In an effort to make custom fences more useful, we wanted to be able to pass the `Markdown` object to the
formatters. This gives custom formats access to things like metadata if required.

The format of custom fence formatters already had two different versions: ones without custom options and one with
custom options. As adding yet another parameter would cause more complexity behind the scenes, we decided to introduce
the breaking change of creating a unified format for formatters with custom options and without. In addition to unifying
the format, we also now pass the `Markdown` object to the formatters as an additional parameter.

While we were breaking custom formats, it seemed like a good time to go ahead and change the defaults for the
`custom_fences` options. Most people who are using SuperFences aren't even using the default, niche `flow` and
`sequence` custom fences. Instead of hijacking fence names that most people aren't even using, it seemed more
appropriate to define no custom fences.

Below are instructions on how to upgrade if you were relying on the either the default settings of `custom_fences` or if
you had written your own custom fence formatters.

1. If you've written your own custom fence formatters, the number of parameters needed has changed, so you must update
  your existing formatters.  The needed parameters are the same regardless of whether you are using an options validator
  or not.

    ```py3
    def custom_formatter(source, language, css_class, options, md):
        return string
    ```

2. `flow` and `sequence` are no longer defined by default. If you were relying on the default custom fences, you will
  have to define them manually now. The needed settings are found below:

    ```py3
    extension_configs = {
        "pymdownx.superfences": {
            "custom_fences": [
                {
                    'name': 'flow',
                    'class': 'uml-flowchart',
                    'format': pymdownx.superfences.fence_code_format
                },
                {
                    'name': 'sequence',
                    'class': 'uml-sequence-diagram',
                    'format': pymdownx.superfences.fence_code_format
                }
            ]
        }
    }
    ```

    If you are attempting to configure these options in a YAML based configuration (like in [MkDocs][mkdocs]), please
    see the [FAQ](../faq.md#function-references-in-yaml) to see how to specify function references in YAML.

--8<-- "refs.txt"
